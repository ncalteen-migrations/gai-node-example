name: Node.js_Pipeline_Example/main
on:
  workflow_dispatch:
env:
  OWNER: ncalteen-migrations
  REPO: gai-node-example
jobs:
  Check_Node:
    name: Check Node
    runs-on: ubuntu-latest
    container:
      image: node:18.16.0-alpine
    #       # This item has no matching transformer
    #       docker:
    #         key: args
    #         value:
    #           isLiteral: true
    #           value: "-u root:root"
    steps:
      - name: checkout
        uses: actions/checkout@v3.5.0
      - name: sh
        shell: sh
        run: node --version
      - name: sh
        shell: sh
        run: npm ci
      - name: sh
        shell: sh
        run: npm test
      - name: Publish test results
        uses: EnricoMi/publish-unit-test-result-action@v2.7.0
        if: always()
        with:
          junit_files: reports/**/*.xml
      - name: sh
        shell: sh
        run: npx cucumber-js --config ./cucumber.json
      - name: Cucumber
        uses: deblockt/cucumber-report-annotations-action@v1.11
        with:
          access-token: '${{ secrets.GITHUB_TOKEN }}'
          path: '**/cucumber-report.json'
      - name: echo message
        run: echo Publishing to @${{ env.OWNER }}/${{ env.REPO }}
      - name: sh
        shell: sh
        run: npm publish --registry https://npm.pkg.github.com/
